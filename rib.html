<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Mon RIB et Informations Bancaires - Banque de France</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="shared.js"></script>
    <style>
        /* Styles d'en-t√™te Site B (Reprise du dashboard) */
        header { background-color: #003366; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .top-bar { display: flex; justify-content: space-between; width: 100%; }
        .user-info, .account-info, .advisor { margin-right: 20px; }
        .user-info span { display: block; }
        .account-info { text-align: right; }
        .account-info span { display: block; font-weight: bold; }
        .account-info .balance { font-size: 1.2em; color: #ffcc00; }
        nav ul { list-style: none; padding: 0; margin: 0; display: flex; gap: 20px; font-weight: bold; }
        nav a { text-decoration: none; color: #003366; }
        nav { background-color: #e0e6ed; padding: 10px 30px; display: flex; justify-content: space-between; align-items: center; }

        /* Layout principal Site B */
        main { display: flex; padding: 30px; gap: 40px; }
        .main-content { flex: 3; }
        aside.right-panel { flex: 1; display: flex; flex-direction: column; gap: 10px; }
        aside.right-panel button { padding: 10px; background-color: #003366; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }

        /* Styles sp√©cifiques au RIB */
        .rib-box {
            background: #fff;
            padding: 25px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .rib-box table { margin-top: 15px; width: 100%; border-collapse: collapse; }
        .rib-box th, .rib-box td { font-size: 1.05em; padding: 12px 10px; border-bottom: 1px solid #eee; text-align:left; }
        .rib-box th { width: 30%; background-color: #f9f9f9; color: #003366; }
        .rib-box td { font-weight: bold; color: #d9534f; font-family: 'Courier New', monospace; }
        #rib-name { font-family: Arial, sans-serif; color: #003366; } /* Nom en police normale */
        .btn-primary { background-color: #003366; color: white; padding: 12px 20px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>
<header>
    <div class="top-bar">
        <div class="user-info"><img src=https://upload.wikimedia.org/wikipedia/commons/thumb/6/65/Banque_de_France_Logo.svg/1280px-Banque_de_France_Logo.svg.png height=85 width=155>
            <span>Bienvenue <strong id="user-name-header">...</strong></span>
            <span id="last-conn" class="last-conn">Derni√®re connexion...</span>
        </div>
        <div class="account-info">
            <span class="balance" id="client-solde">0,00 ‚Ç¨</span>
        </div>
        <div class="advisor">
            <p>Votre conseiller<br><strong id="advisor-name">Chargement...</strong></p>
            <a href="index.html" class="status">Se d√©connecter</a> 
        </div>
    </div>
</header>

<nav>
    <ul>
        <li><a href="dashboard.html">VOS COMPTES ET PRODUITS</a></li>
        <li><a href="historique.html">OPERATIONS COURANTES</a></li>
        <li><a href="profil.html">PROFIL ET DOCUMENTS</a></li>
    </ul>
    <input type="search" placeholder="Rechercher" class="search-bar">
</nav>

<main>
    <div class="main-content">
        <h2>Relev√© d'Identit√© Bancaire (RIB)</h2>
        <p>Ce document fournit vos coordonn√©es bancaires compl√®tes pour la r√©ception de virements SEPA ou internationaux.</p>

        <div class="rib-box">
            <h4>Informations Bancaires de Compte de D√©p√¥t</h4>
            <table>
                <tbody>
                    <tr><th>Titulaire du Compte</th><td id="rib-name">Chargement...</td></tr>
                    <tr><th>Domiciliation Bancaire</th><td>GT BANK FRANCE (Si√®ge)</td></tr>
                    <tr><th>IBAN</th><td id="rib-iban">Chargement...</td></tr>
                    <tr><th>BIC (SWIFT)</th><td id="rib-bic">Chargement...</td></tr>
                </tbody>
            </table>
            <button class="btn-primary" style="margin-top: 20px;" onclick="alert('L\'impression du RIB n\'est pas support√©e dans cette simulation.')">üñ® Imprimer ce RIB</button>
        </div>
    </div>

    <aside class="right-panel">
        <a href="dashboard.html"><button>SYNTH√àSE DES COMPTES</button></a>
        <a href="historique.html"><button>HISTORIQUE DES OP√âRATIONS</button></a>
        <a href="profil.html"><button>Mon Profil</button></a>
        <a href="virement.html"><button>FAIRE UN VIREMENT</button></a>
        <a href="mes-cartes.html"><button>MES CARTES</button></a>
        <button class="sav" onclick="alert('VOTRE ESPACE SAV')">VOTRE ESPACE SAV</button>
    </aside>
</main>

<footer>
 <p>¬© BANQUE DE FRANCE - 39 Rue Croix des Petits Champs, 75001 Paris, France </p>
</footer>

<script>
document.addEventListener('DOMContentLoaded', async () => {
    
    // 1. R√©cup√©rer les donn√©es les plus fra√Æches de Firebase
    // ‚ö†Ô∏è CORRECTION : Utilisation de la fonction checkAuth (corrig√©e dans shared.js)
    const user = await checkAuth(); 
    
    if (!user) {
        // La redirection vers index.html est g√©r√©e par checkAuth() si l'utilisateur n'est pas trouv√©.
        return;
    }

    // --- Mise √† jour de l'UI de l'en-t√™te (Donn√©es Firestore) ---
    // Affichage du pr√©nom et nom (comme g√©r√© dans checkAuth pour la coh√©rence)
    const nameParts = user.name.split(' ');
    const display = nameParts.length > 1 ? `${nameParts[0]} ${nameParts[1]}` : user.name;
    
    document.getElementById('user-name-header').textContent = display;
    document.getElementById('client-solde').textContent = formatCurrency(user.solde);
    document.getElementById('advisor-name').textContent = user.advisor || 'Non attribu√©';
    document.getElementById('last-conn').textContent = `Derni√®re connexion le ${user.lastConnection}`;
    
    // 2. Affichage des donn√©es du RIB (lecture des champs user.rib et user.bic)
    document.getElementById('rib-name').textContent = user.name.toUpperCase();
    
    // Formatage de l'IBAN pour la lisibilit√© (groupement par 4 caract√®res)
    const ibanRaw = user.rib || 'NON RENSEIGN√â';
    // Assurez-vous que la cha√Æne n'est pas vide avant d'essayer de la formater
    const formattedIban = ibanRaw.length > 0 ? ibanRaw.match(/.{1,4}/g).join(' ') : ibanRaw;
    
    document.getElementById('rib-iban').textContent = formattedIban;
    document.getElementById('rib-bic').textContent = user.bic || 'NON RENSEIGN√â';
});
</script>
</body>
</html>